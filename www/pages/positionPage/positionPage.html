<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="买单返-消费即返利，单单返红包">
  <meta name="keywords" content="买单返，maidanfan">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <title>买单返</title>

  <!-- Set render engine for 360 browser -->
  <meta name="renderer" content="webkit">

  <!-- No Baidu Siteapp-->
  <meta http-equiv="Cache-Control" content="no-siteapp"/>

  <link rel="icon" type="image/png" href="../../i/favicon.png">


  <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
  <!--
  <link rel="canonical" href="http://www.example.com/">
  -->
  <link rel="stylesheet" href="../../css/amazeui.css">
  <link rel="stylesheet" href="positionPage.css">
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="js/html5shiv.min.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->
</head>
<body>


  <!-- 头部 -->
   <header class="am-header am-header-default" data-am-widget="header">
    <div class="am-container am-text-center">
      <a href="javascript:" onclick="history.back(-1);" class="am-icon-angle-left am-text-xl am-fl" style="color:#fff;">
      </a>
      <span class="am-text-lg" style="color:#fff;margin-left:-15px;">位置信息</span>
    </div> 
  </header>
  <!-- 搜索框 -->
  <div class="am-container am-text-center am-padding-sm searchBox">
    <i class="am-icon-search searchIcon"></i>

    <input type="text" placeholder="搜索关键字" class="am-round am-text-left search-input"/>
  </div>
  <!-- 位置信息 -->
  <div class="am-container am-text-sm">
    <div class="am-u-sm-3">
      <span class="defaultFont">当前位置：</span>
    </div>
    <div class="am-u-sm-7">
      <span id="currentAdress"></span>
    </div>
    <div id="refresh" class="am-u-sm-2">
      <i class="am-icon-refresh am-text-lg am-fr "></i>
    </div>
  </div>
  <div class="am-container am-cf">
      <span class="am-text-sm defaultFont">当前城市</span><br>
      <button id="currentCity" class="am-btn am-btn-lg am-radius am-text-center am-text-default am-margin-top-xs am-padding-horizontal-lg defaultBtn">西安</button>
    </div>
  </div>
  <div class="am-container am-cf">
      <span class="am-text-sm defaultFont">热门城市</span>
      <ul id="hotcity" class="am-text-center" style="list-style:none;overflow:hidden;padding-left:0;">

            <!-- 热门城市 -->
      
      </ul>
  </div>
  <div class="am-container" style="color:#333;">
    <span class="am-text-sm defaultFont">更多城市</span>
  </div>
  <div id="morecity"></div>
  <!-- A -->
 <!--  <div class="am-container">
    <a href="javascript:;" id="symbol-A" class="am-text-sm am-padding-sm" style="color:#333;">A</a>
  </div>
  <div class="am-container">
    <ul class="am-list am-text-xs">
      <li class="am-padding-xs"><apan href="">阿拉尔</apan></li>
      <li class="am-padding-xs"><span>阿拉善</span></li>
      <li class="am-padding-xs"><span>adigd</span></li>
      <li class="am-padding-xs"><span>阿拉尔</span></li>
    </ul>
  </div>
  <!-- B -->

 
 <br><br> <br><br><br>  

  <!-- 右侧选择条 -->
  <div id="rightSide-bar" class="am-text-xs am-text-center"><a href="#symbol-A" class="rightSide-bar-txt">A</a>
    <a href="#symbol-B" class="rightSide-bar-txt">B</a>
    <a href="#symbol-C" class="rightSide-bar-txt">C</a>
    <a href="#symbol-D" class="rightSide-bar-txt">D</a>
    <a href="#symbol-E" class="rightSide-bar-txt">E</a>
    <a href="#symbol-F" class="rightSide-bar-txt">F</a>
    <a href="#symbol-G" class="rightSide-bar-txt">G</a>
    <a href="#symbol-H" class="rightSide-bar-txt">H</a>
    <a href="#symbol-I" class="rightSide-bar-txt">I</a>
    <a href="#symbol-J" class="rightSide-bar-txt">J</a>
    <a href="#symbol-K" class="rightSide-bar-txt">K</a>
    <a href="#symbol-L" class="rightSide-bar-txt">L</a>
    <a href="#symbol-M" class="rightSide-bar-txt">M</a>
    <a href="#symbol-N" class="rightSide-bar-txt">N</a>
    <a href="#symbol-O" class="rightSide-bar-txt">O</a>
    <a href="#symbol-P" class="rightSide-bar-txt">P</a>
    <a href="#symbol-Q" class="rightSide-bar-txt">Q</a>
    <a href="#symbol-R" class="rightSide-bar-txt">R</a>
    <a href="#symbol-S" class="rightSide-bar-txt">S</a>
    <a href="#symbol-T" class="rightSide-bar-txt">T</a>
    <a href="#symbol-U" class="rightSide-bar-txt">U</a>
    <a href="#symbol-V" class="rightSide-bar-txt">V</a>
    <a href="#symbol-W" class="rightSide-bar-txt">W</a>
    <a href="#symbol-X" class="rightSide-bar-txt">X</a>
    <a href="#symbol-Y" class="rightSide-bar-txt">Y</a>
    <a href="#symbol-Z" class="rightSide-bar-txt">Z</a>
  </div>
<div data-am-widget="navbar" class="am-navbar am-text-center">
    <ul class="am-navbar-nav am-cf am-avg-sm-4">
      <li>
        <a href="../home/home.html">
          <span class="am-icon-home"></span>
          <span class="am-navbar-label">首页</span>
        </a>
      </li>
     
      <li>
        <a href="../positionPage/positionPage.html"  style="color:#E60827;">
          <span class="am-icon-compass"></span>
          <span class="am-navbar-label">附近</span>
        </a>
      </li>
      <li>
        <a href="../../index.html">
          <span class="am-icon-user"></span>
          <span class="am-navbar-label">个人中心</span>
        </a>
      </li>
       <li>
        <a href="../businessRecommend/businessRecommend.html">
          <span class="am-icon-bookmark"></span>
          <span class="am-navbar-label">商家推荐</span>
        </a>
      </li>
    </ul>
  </div>
   <!-- 选择弹框 -->
<button
  style="visibility:hidden;"
  type="button"
  class="am-btn am-btn-warning"
  id="doc-confirm-toggle">
  Confirm
</button>

<div class="am-modal am-modal-confirm" tabindex="-1" id="my-confirm">
  <div class="am-modal-dialog">
    <div class="am-modal-hd">提示</div>
    <div id= "accpos" class="am-modal-bd">
    </div>
    <div class="am-modal-footer">
      <span class="am-modal-btn" data-am-modal-cancel>取消</span>
      <span class="am-modal-btn" data-am-modal-confirm>确定</span>
    </div>
  </div>
</div>
<!-- 选择弹框 -->

  <div id="allmap" style="width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";"></div>
  <script type="text/javascript" src="../../js/jquery.min.js"></script>
  <script type="text/javascript" src="http://cdn.amazeui.org/amazeui/2.7.2/js/amazeui.min.js"></script>
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=uPkQLGLNyubqiTc3YVdt8icMxfiBk1vZ"></script>
  <script src="positionPage.js"></script>
  <script>

      // 百度地图API功能
   var htt = "http://172.20.9.226:8080";
    $("#refresh").find("i").addClass("am-icon-spin");
     $("#currentCity").text("定位中...");
     $("#currentAdress").text("定位中...");
     var ref;
  function position (){
    var geoc = new BMap.Geocoder();    
    var geolocation = new BMap.Geolocation();
    geolocation.getCurrentPosition(function(r){
      if(this.getStatus() == BMAP_STATUS_SUCCESS){
        //alert('您的位置：'+r.point.lng+','+r.point.lat);
             localStorage.setItem("lat", r.point.lat);
             localStorage.setItem("lng", r.point.lng);
             alert(r.point.lat+","+r.point.lng);

        geoc.getLocation(r.point, function(rs){
          var addComp = rs.addressComponents;
          var text = (addComp.province + addComp.city + addComp.district  + addComp.street + addComp.streetNumber);
          var city = addComp.city ;
          var district = addComp.district ;
           $("#currentCity").text(district);
            $("#currentAdress").text(text);

             $("#refresh").find("i").removeClass("am-icon-spin");
             //定位成功返回
              var is = 1;
              var time = setTimeout(function(){
                if(is == 1){
               
                 $("#doc-confirm-toggle").click();       //弹出选择
                 $("#accpos").text("确定当前位置是："+city+district+"吗？");

                 //location.href = ref;
                }
              },1000);

                 //刷新
                $("#refresh").click(function(){
                    $(this).find("i").addClass("am-icon-spin");
                    $("#currentCity").text("定位中...");
                    $("#currentAdress").text("定位中...");
                    position();
                    is =0;

                });
                //刷新
                   
         
        }); 

      }
      else {
        alert('failed'+this.getStatus());
      }        
    },{enableHighAccuracy: true});
  }

  

  $('#doc-modal-list').find('.am-icon-close').add('#doc-confirm-toggle').
    on('click', function() {
      $('#my-confirm').modal({
        relatedTarget: this,
        onConfirm: function(options) {
          var $link = $(this.relatedTarget).prev('a');
          var lat =  localStorage.getItem("lat");
          var lng =  localStorage.getItem("lng");
          var data = {"lat":lat,"lng":lng};
              $.ajax({
                    url: htt+"/App/Index/locationCity",
                    type: "get",
                    data:data,
                    dataType: "json",
                    success: function(re) {
                         console.log(re);
                       
                         alert(JSON.stringify(re));

                        if(re.code ==1){
                          localStorage.setItem("city_id",re.data.city_id);     //存城市ID
                          localStorage.setItem("city_name",re.data.city_name);     //存城市ID

                          location = "../home/home.html?address="+re.data.city_name;       //跳转
                        }
                        if(re.code ==0){
                            alert("此区域暂未开通，请选择其他试试")
                        }
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                        // alert(XMLHttpRequest.status);
                        // alert(XMLHttpRequest.readyState);
                        // alert(textStatus);
                    },
                    complete: function(XMLHttpRequest, textStatus) {
                        this; // 调用本次AJAX请求时传递的options参数
                    }
                });

       
         
        },
        // closeOnConfirm: false,
        onCancel: function() {
          //alert('算求，不弄了');
        }
      });
    });

position();



    //热门城市
        $.ajax({
        url: htt+"/App/Index/hostCity",
        type: "get",
        dataType: "json",
        success: function(re) {
           if(re.code == 1){
             var cityarr = re.data;
             console.log(cityarr);
              for (var i = 0; i <cityarr.length; i++) {
                  $("<li dataid='"+cityarr[i].id+"' class='am-fl'><a href='../home/home.html'><button style='color:#333' class='am-btn am-btn-lg am-radius am-text-sm am-margin-xs am-padding-sm defaultBtn'>"+cityarr[i].name+"</button></a></li>").appendTo($("#hotcity"));
               }

                 $("#hotcity li").click(function(){
                  localStorage.setItem("city_name", $(this).find("button").text());
                  localStorage.setItem("city_id", $(this).attr("dataid"));
                 })
           }
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) {
            // alert(XMLHttpRequest.status);
            // alert(XMLHttpRequest.readyState);
            // alert(textStatus);
        },
        complete: function(XMLHttpRequest, textStatus) {
            this; // 调用本次AJAX请求时传递的options参数
        }
    });
    
   
   
    //热门城市
    //更多城市
      $.ajax({
        url: htt+"/App/Index/cityList",
        type: "get",
        dataType: "json",
        success: function(re) {
           if(re.code == 1){
             var data = re.data;
             console.log(data);

             var ul_html="";
             var html ="";
              var url = "../home/home.html";
             for (var i = 0; i <data.length; i++) {
                 for (var j = 0; j < data[i].city.length; j++) {
                     ul_html+= "<li class='am-padding-xs'><a dataid='"+data[i].city[j].id+"' href='"+url+"' style='padding:0;color:#333'><span>"+data[i].city[j].name+"</span></a></li>";
                 }
                var sy = "symbol-"+data[i].letter;
                html+=" <div class='am-container'>"+
                          "<a href='javascript:;' id='"+sy+"' class='am-text-sm am-padding-sm' style='color:#333;'>"+data[i].letter+"</a>"+
                       "</div>"+
                       "<div class='am-container'>"+
                         " <ul class='am-list am-text-xs'>"+
                            ul_html
                          +"</ul>"+
                        "</div>";
             }
            
             $("#morecity").append($(html));

             $("#morecity").find("li").click(function(){
                  var id = $(this).find("a").attr("dataid");
                  var city =  $(this).find("span").text();
                  localStorage.setItem("city_name",city);
                  localStorage.setItem("city_id", id);
                  
              })


            
           }
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) {
            // alert(XMLHttpRequest.status);
            // alert(XMLHttpRequest.readyState);
            // alert(textStatus);
        },
        complete: function(XMLHttpRequest, textStatus) {
            this; // 调用本次AJAX请求时传递的options参数
        }
    });
 

    //更多城市
    

  </script>
</body>
</html>